(this.webpackJsonppikabook=this.webpackJsonppikabook||[]).push([[0],{30:function(e,t,r){},38:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),s=r(22),c=r.n(s),o=(r(30),r(2)),i=r.n(o),u=r(4),l=r(3),j=r(5),b=r(6),d=r.p+"static/media/pikabook.d219f79b.png",p=r(0),h=function(e){var t=e.setAccessToken,r=e.loggedUser._id,n=e.loggedUsersPokes,a=e.loggedUsersConversations,s=function(){return n.filter((function(e){return e.recipient._id===r})).filter((function(e){return!e.read})).length},c=function(){return a.filter((function(e){var t=e.messages[0],n=t.read,a=t.recipient;return!n&&a===r})).length};return Object(p.jsxs)("div",{className:"nav",children:[Object(p.jsxs)(j.c,{className:"nav-item",activeClassName:"is-active",to:"/search",children:[Object(p.jsx)("i",{className:"fas fa-search"}),Object(p.jsx)("span",{children:"Search"})]}),Object(p.jsxs)(j.c,{className:"nav-item",activeClassName:"is-active",to:"/me/conversations",children:[Object(p.jsx)("i",{className:"fas fa-envelope"}),Object(p.jsx)("span",{children:"Messages"}),c()>0&&Object(p.jsx)("div",{className:"alert",children:c()})]}),Object(p.jsxs)(j.c,{className:"nav-item",activeClassName:"is-active",to:"/me/basket",children:[Object(p.jsx)("i",{className:"fas fa-shopping-basket"}),Object(p.jsx)("span",{children:"Baskets"})]}),Object(p.jsxs)(j.c,{className:"nav-item",activeClassName:"is-active",to:"/me",exact:!0,children:[Object(p.jsx)("i",{className:"fas fa-user-circle"}),Object(p.jsx)("span",{children:"My profile"})]}),Object(p.jsxs)(j.c,{className:"nav-item",activeClassName:"is-active",to:"/me/books",children:[Object(p.jsx)("i",{className:"fas fa-book"}),Object(p.jsx)("span",{children:"My books"})]}),Object(p.jsxs)(j.c,{className:"nav-item",activeClassName:"is-active",to:"/me/pokes",children:[Object(p.jsx)("i",{class:"fas fa-bell"}),s()>0&&Object(p.jsx)("div",{className:"alert",children:s()})]}),Object(p.jsx)(j.c,{className:"nav-item log-out",to:"/",onClick:function(){t("")},children:Object(p.jsx)("i",{className:"fas fa-power-off"})})]})},O=function(e){var t=e.setAccessToken,r=e.accessToken,n=e.loggedUser,a=e.loggedUsersPokes,s=e.loggedUsersConversations;return Object(p.jsxs)("header",{children:[Object(p.jsx)("img",{className:"img-logo",src:d,alt:"Pikabook"}),r&&Object(p.jsx)(h,{setAccessToken:t,loggedUser:n,loggedUsersPokes:a,loggedUsersConversations:s})]})},x=r.p+"static/media/pikachu.8624571d.png",f=function(){return Object(p.jsxs)("footer",{children:[Object(p.jsx)("div",{className:"books"}),Object(p.jsxs)("div",{className:"about",children:[Object(p.jsxs)("p",{children:["Pikabook APP is for book lovers. Are you one of them? If so,"," ",Object(p.jsx)("span",{children:"pick a book"})," you want to read. Then suggest yours you have already read. That's all. ",Object(p.jsx)("span",{children:"Connect with other bookworms!"})]}),Object(p.jsxs)("div",{className:"github",children:["Application made as part of the ",Object(p.jsx)("b",{children:"CodersCamp2020"})," project.",Object(p.jsx)("br",{}),Object(p.jsx)(j.b,{to:{pathname:"https://github.com/lukaszdutka/CodersCamp2020.Project.FullStack-Node-React.PikaBook-frontend"},target:"_blank",children:"Visit Github for more information."})]})]}),Object(p.jsxs)("div",{className:"authors",children:[Object(p.jsxs)("div",{children:[Object(p.jsx)("b",{children:"Created by Mangosteam"}),Object(p.jsxs)("ul",{children:[Object(p.jsx)("li",{children:"Mentor: \u0141ukasz Dutka"}),Object(p.jsx)("li",{children:"Aleksandra Cypko"}),Object(p.jsx)("li",{children:"Ma\u0142gorzata Dziewit"}),Object(p.jsx)("li",{children:"Daria Dziuba\u0142towska"}),Object(p.jsx)("li",{children:"Agata Ludwiczy\u0144ska"}),Object(p.jsx)("li",{children:"Mariusz Smar\u017c"})]})]}),Object(p.jsx)("img",{src:x,alt:"pikachu"})]})]})},k=function(){var e=Object(u.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/auth",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})});case 2:if((n=e.sent).ok){e.next=10;break}return e.next=6,n.text();case 6:return n=e.sent,e.abrupt("return",{error:n});case 10:return e.next=12,n.json();case 12:return n=e.sent,e.abrupt("return",{accessToken:n.token});case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),m=function(e){var t=e.setAccessToken,r=Object(n.useState)(""),a=Object(l.a)(r,2),s=a[0],c=a[1],o=Object(n.useState)(""),b=Object(l.a)(o,2),d=b[0],h=b[1],O=Object(n.useState)(),x=Object(l.a)(O,2),f=x[0],m=x[1],v=function(e){return"loginEmail"===e.target.id?c(e.target.value):"loginPassword"===e.target.id?h(e.target.value):void 0},g=function(){var e=Object(u.a)(i.a.mark((function e(r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),m("Wait..."),e.next=4,k(s,d);case 4:(n=e.sent).error&&m(n.error),c(""),h(""),n.accessToken&&t(n.accessToken);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)("div",{className:"logInAndRegistration",children:Object(p.jsxs)("form",{onSubmit:g,children:[Object(p.jsx)("h1",{children:"Log in"}),Object(p.jsx)("input",{className:"textInputDark",type:"email",id:"loginEmail",placeholder:"E-mail",value:s,onChange:v,required:!0}),Object(p.jsx)("input",{className:"textInputDark",type:"password",id:"loginPassword",placeholder:"Password",value:d,onChange:v,required:!0}),Object(p.jsx)("input",{type:"submit",value:"Log in",className:"buttonDark"}),Object(p.jsx)("div",{className:"status",children:"Wait..."===f?Object(p.jsx)("div",{className:"loader"}):f}),Object(p.jsx)("p",{children:Object(p.jsx)(j.b,{to:"/registration",children:"CREATE A NEW ACCOUNT!"})})]})})},v=function(){var e=Object(u.a)(i.a.mark((function e(t,r,n,a){var s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/users",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({name:t,email:r,password:n,location:a})});case 2:if((s=e.sent).ok){e.next=10;break}return e.next=6,s.text();case 6:return s=e.sent,e.abrupt("return",{created:!1,error:s});case 10:return e.next=12,s.json();case 12:return s=e.sent,e.abrupt("return",{created:!0});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),g=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),r=t[0],a=t[1],s=Object(n.useState)(""),c=Object(l.a)(s,2),o=c[0],j=c[1],d=Object(n.useState)(""),h=Object(l.a)(d,2),O=h[0],x=h[1],f=Object(n.useState)(""),k=Object(l.a)(f,2),m=k[0],g=k[1],N=Object(n.useState)(),y=Object(l.a)(N,2),C=y[0],w=y[1],S=Object(b.g)(),D=function(e){return"registerUsername"===e.target.id?a(e.target.value):"registerEmail"===e.target.id?j(e.target.value):"registerPassword"===e.target.id?x(e.target.value):"registerLocation"===e.target.id?g(e.target.value):void 0},T=function(){var e=Object(u.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w("Request is being sent"),t.preventDefault(),e.next=4,v(r,o,O,m);case 4:(n=e.sent).error?w(n.error):w("Account successfully created"),a(""),j(""),x(""),g(""),n.created&&setTimeout((function(){S.push("/")}),2e3);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)("div",{className:"logInAndRegistration",children:Object(p.jsxs)("form",{onSubmit:T,children:[Object(p.jsx)("h1",{children:"Register"}),Object(p.jsx)("input",{type:"text",className:"textInputDark",id:"registerUsername",placeholder:"Name",value:r,onChange:D,required:!0}),Object(p.jsx)("input",{type:"email",className:"textInputDark",id:"registerEmail",placeholder:"E-mail",value:o,onChange:D,required:!0}),Object(p.jsx)("input",{type:"password",className:"textInputDark",id:"registerPassword",placeholder:"Password",value:O,onChange:D,required:!0}),Object(p.jsx)("input",{type:"text",className:"textInputDark",id:"registerLocation",placeholder:"Location",value:m,onChange:D,required:!0}),Object(p.jsx)("input",{type:"submit",value:"Create a new account",className:"buttonDark"}),Object(p.jsx)("div",{className:"status",children:"Request is being sent"===C?Object(p.jsx)("div",{className:"loader"}):C})]})})},N=function(e){return e.map((function(t,r){return r<e.length-1?t+", ":t})).join("")},y=function(e){var t=e.book,r=t.name,n=t.author,a=t.ownerId,s=t._id,c=Object(b.g)();return Object(p.jsxs)("div",{className:"book",children:[Object(p.jsxs)("div",{className:"bookData",children:[Object(p.jsx)("h3",{children:r}),Object(p.jsx)("p",{children:N(n)})]}),Object(p.jsxs)("div",{className:"userData",children:[Object(p.jsx)("p",{children:a.name}),Object(p.jsxs)("p",{children:[a.location," ",a.location&&Object(p.jsx)("i",{className:"fas fa-map-marker-alt",children:" "})]})]}),Object(p.jsx)("input",{className:"buttonDark",type:"button",value:"User's profile",id:s,onClick:function(e){c.push("/user/".concat(a._id),{bookId:e.target.id})}})]})},C=function(e){return S("https://pikabook.herokuapp.com/api/me/books",{},e)},w=function(e){return S("https://pikabook.herokuapp.com/api/users/".concat(e,"/books"))},S=function(){var e=Object(u.a)(i.a.mark((function e(t){var r,n,a,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},n=s.length>2&&void 0!==s[2]?s[2]:"",e.next=4,fetch(t+new URLSearchParams(r),{method:"get",headers:{Authorization:"Bearer ".concat(n)}});case 4:if((a=e.sent).ok){e.next=12;break}return e.next=8,a.text();case 8:return a=e.sent,e.abrupt("return",{books:[],error:a});case 12:return e.next=14,a.json();case 14:return a=e.sent,e.abrupt("return",{books:a});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(e,t,r){var n=e*t-t,a=n+t-1;return r.filter((function(e,t){return t>=n&&t<=a}))},T=function(e){var t=e.page,r=e.setPage,n=e.list,a=e.limit,s=e.scrollTo,c=function(){var e=Math.ceil(n.length/a);return e<1?1:e},o=function(e,n){var a=c();"next"===n&&t<a&&r(t+1),"previous"===n&&t>1&&r(t-1),"input"===n&&r(e.target.value),s&&s.current.scrollIntoView({behavior:"smooth",block:"start"})},i=c();return Object(p.jsxs)("div",{className:"pagination",children:[t>1&&Object(p.jsx)("button",{className:"buttonArrow prev",onClick:function(e){return o(e,"previous")},children:"\u2190"}),Object(p.jsx)("span",{children:"Page "}),Object(p.jsx)("input",{type:"number",value:t,min:"1",max:i,onChange:function(e){return o(e,"input")}}),Object(p.jsxs)("span",{children:[" out of ",i]}),t<i&&Object(p.jsx)("button",{className:"buttonArrow next",onClick:function(e){return o(e,"next")},children:"\u2192"})]})},A=function(e){var t=e.loggedUser,r=Object(n.useState)(""),a=Object(l.a)(r,2),s=a[0],c=a[1],o=Object(n.useState)(""),j=Object(l.a)(o,2),b=j[0],d=j[1],h=Object(n.useState)(""),O=Object(l.a)(h,2),x=O[0],f=O[1],k=Object(n.useState)(""),m=Object(l.a)(k,2),v=m[0],g=m[1],N=Object(n.useState)([]),C=Object(l.a)(N,2),w=C[0],A=C[1],B=Object(n.useState)("Let's start searching!"),I=Object(l.a)(B,2),_=I[0],P=I[1],U=Object(n.useState)(1),R=Object(l.a)(U,2),L=R[0],E=R[1],M=Object(n.useRef)(),z=function(e){return"searchTitle"===e.target.id?c(e.target.value):"searchAuthor"===e.target.id?f(e.target.value):"searchGenre"===e.target.id?g(e.target.value):"searchLocation"===e.target.id?d(e.target.value):void 0},V=function(){var e=Object(u.a)(i.a.mark((function e(r){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),P("Searching..."),E(1),e.next=5,S("https://pikabook.herokuapp.com/api/books?",{name:s,location:b,author:x,genres:v});case 5:(n=e.sent).error&&P(n.error),a=n.books.filter((function(e){return e.ownerId._id!==t._id})),A(a),0===a.length?P("No books found"):P("".concat(a.length," book(s) found"));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=D(L,10,w);return q=q.map((function(e){return Object(p.jsx)(y,{book:e},e._id)})),Object(p.jsxs)("div",{className:"search",children:[Object(p.jsx)("div",{className:"logInAndRegistration",children:Object(p.jsxs)("form",{onSubmit:V,children:[Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"searchTitle",placeholder:"Book's title",value:s,onChange:z}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"searchAuthor",placeholder:"Book's author",value:x,onChange:z}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"searchGenre",placeholder:"Book's genre",value:v,onChange:z}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"searchLocation",placeholder:"Location",value:b,onChange:z}),Object(p.jsx)("input",{className:"buttonDark",type:"submit",value:"Search"}),Object(p.jsx)("div",{className:"status",children:"Searching..."===_?Object(p.jsx)("div",{className:"loader"}):_})]})}),Object(p.jsxs)("div",{ref:M,children:[w.length>10&&Object(p.jsx)(T,{page:L,setPage:E,list:w,limit:10,scrollTo:M}),Object(p.jsx)("div",{className:"booksList",children:q}),w.length>10&&Object(p.jsx)(T,{page:L,setPage:E,list:w,limit:10,scrollTo:M})]})]})},B=function(e){return _("https://pikabook.herokuapp.com/api/me",e)},I=function(e){return _("https://pikabook.herokuapp.com/api/users/".concat(e))},_=function(){var e=Object(u.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"get",headers:{Authorization:"Bearer ".concat(r)}});case 2:if((n=e.sent).ok){e.next=10;break}return e.next=6,n.text();case 6:return n=e.sent,e.abrupt("return",{error:n});case 10:return e.next=12,n.json();case 12:return n=e.sent,e.abrupt("return",{user:n});case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),P=r(25),U=function(e,t,r){if(!e.target.checked)return r.filter((function(t){return t._id!==e.target.id}));if(e.target.checked){var n=t.find((function(t){return t._id===e.target.id}));return[].concat(Object(P.a)(r),[n])}},R=function(e){var t=e.book,r=t._id,n=t.name,a=t.author,s=t.genres,c=t.publisher,o=t.year,i=t.description,u=e.type,l=e.handleCheckboxChange,j=e.inputDisabled,b=e.chosenBooks;return Object(p.jsxs)("div",{className:"bookContainer",children:[Object(p.jsxs)("div",{className:"bookInfo",children:[Object(p.jsx)("p",{className:"bookTitle",children:Object(p.jsx)("b",{children:n})}),a.length>0&&Object(p.jsxs)("p",{className:"author",children:[Object(p.jsx)("b",{children:"Author:"})," ",N(a)]}),c&&Object(p.jsxs)("p",{className:"publisher",children:[Object(p.jsx)("b",{children:"Publisher:"})," ",c]}),o&&Object(p.jsxs)("p",{className:"year",children:[Object(p.jsx)("b",{children:"Publication year:"})," ",o]}),s.length>0&&Object(p.jsxs)("p",{className:"genres",children:[Object(p.jsx)("b",{children:"Genre:"})," ",N(s)]}),i&&Object(p.jsxs)("p",{className:"description",children:[Object(p.jsx)("b",{children:"Description:"})," ",i]})]}),"checkbox"===u&&Object(p.jsx)("input",{className:"checkboxStyled",type:"checkbox",onChange:l,id:r,disabled:j,checked:b.some((function(e){return e._id===r}))})]})},L=function(e){var t=e.book,r=t.name,n=t.author,a=t.publisher,s=t.year,c=t._id;return Object(p.jsxs)("li",{children:[Object(p.jsx)("b",{children:r}),n.length>0&&" by ".concat(N(n))," ",a," ",s]},c)},E=function(){var e=Object(u.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/pokes",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({recipient:r,books:n})});case 2:if((a=e.sent).ok){e.next=10;break}return e.next=6,a.text();case 6:return a=e.sent,e.abrupt("return",{error:a});case 10:return e.next=12,a.json();case 12:return a=e.sent,e.abrupt("return",{created:!0});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),M=function(e){var t=e.accessToken,r=e.books,a=e.recipient,s=e.setPokeCreatorVisible,c=Object(n.useState)(""),o=Object(l.a)(c,2),j=o[0],b=o[1],d=function(){var e=Object(u.a)(i.a.mark((function e(){var n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map((function(e){return e._id})),e.next=3,E(t,a._id,n);case 3:(s=e.sent).error&&b(s.error),s.created&&b("Poke successfully sent!");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=r.map((function(e){return Object(p.jsx)(L,{book:e},e._id)}));return Object(p.jsxs)("div",{className:"creatorContainer",id:"pokeCreator",children:[!j&&Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("p",{children:["Invite ",Object(p.jsx)("b",{children:a.name})," to browse your book collection and make him/her know that you showed interest in the following books in their possession:"]}),Object(p.jsx)("ul",{children:h.length>0?h:"None"})]}),j&&Object(p.jsx)("p",{children:Object(p.jsx)("b",{children:j})}),Object(p.jsxs)("div",{children:[!j&&Object(p.jsx)("button",{className:"buttonDark",onClick:d,children:"Confirm"}),Object(p.jsx)("button",{className:"buttonDark",onClick:function(){s(!1)},children:j?"Back":"Cancel"})]})]})},z=function(){var e=Object(u.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/conversations",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({recipient:r,content:n})});case 2:if((a=e.sent).ok){e.next=10;break}return e.next=6,a.text();case 6:return a=e.sent,e.abrupt("return",{created:!1,error:a});case 10:return e.next=12,a.json();case 12:return a=e.sent,e.abrupt("return",{created:!0,message:a.content});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),V=function(e){var t=e.accessToken,r=e.recipient,a=e.setMessageCreatorVisible,s=Object(n.useState)(""),c=Object(l.a)(s,2),o=c[0],j=c[1],b=Object(n.useState)(""),d=Object(l.a)(b,2),h=d[0],O=d[1],x=Object(n.useState)(""),f=Object(l.a)(x,2),k=f[0],m=f[1],v=function(){var e=Object(u.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t,r._id,o);case 2:(n=e.sent).error&&m(n.error),n.created&&m("Message successfully sent!"),n.message&&O(n.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"creatorContainer",id:"messageCreator",children:[Object(p.jsxs)("h1",{children:["Send a message to ",r.name]}),h?Object(p.jsx)(p.Fragment,{children:Object(p.jsx)("p",{className:"sentMessage",children:h})}):Object(p.jsx)("textarea",{onChange:function(e){j(e.target.value)},value:o}),k&&Object(p.jsx)("p",{children:Object(p.jsx)("b",{children:k})}),Object(p.jsxs)("div",{children:[!h&&Object(p.jsx)("button",{className:"buttonDark",onClick:v,children:"Confirm"}),Object(p.jsx)("button",{className:"buttonDark",onClick:function(){a(!1)},children:h?"Back":"Cancel"})]})]})},q=function(e){var t=e.accessToken,r=Object(b.i)().id,a=Object(n.useState)([]),s=Object(l.a)(a,2),c=s[0],o=s[1],j=Object(n.useState)(""),d=Object(l.a)(j,2),h=d[0],O=d[1],x=Object(n.useState)([]),f=Object(l.a)(x,2),k=f[0],m=f[1],v=Object(n.useState)(!1),g=Object(l.a)(v,2),N=g[0],y=g[1],C=Object(n.useState)(!1),S=Object(l.a)(C,2),A=S[0],B=S[1],_=Object(n.useState)(""),P=Object(l.a)(_,2),L=P[0],E=P[1],z=Object(n.useState)(1),q=Object(l.a)(z,2),F=q[0],J=q[1],G=Object(n.useRef)(),H=Object(b.g)(),W=Object(b.h)();Object(n.useEffect)((function(){E("Loading...");var e=function(){var e=Object(u.a)(i.a.mark((function e(){var t,n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=W.state.bookId,e.next=3,w(r);case 3:(n=e.sent).error&&E(n.error),n.books&&(a=n.books.sort((function(e,r){return e._id===t?-1:r._id===t?1:0})),o(a),E(""));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(r);case 2:(t=e.sent).error&&console.log(t.error),t.user&&O(t.user);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e(),t()}),[r,W.state.bookId]);var Y=function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:!A&&y(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(e){m(U(e,c,k))},Q=D(F,4,c);return Q=Q.map((function(e){return Object(p.jsx)(R,{book:e,type:"checkbox",handleCheckboxChange:K,inputDisabled:N||A,chosenBooks:k},e._id)})),Object(p.jsxs)("div",{className:"userContainer",children:[Object(p.jsxs)("div",{className:"usersBooks",ref:G,children:[Object(p.jsx)("h1",{className:"booksHeading",children:"Books"}),L||Q,c.length>4&&Object(p.jsx)(T,{page:F,setPage:J,list:c,limit:4,scrollTo:G})]}),Object(p.jsxs)("div",{className:"userPanel",children:[Object(p.jsxs)("div",{className:"userInfo",children:[Object(p.jsx)("p",{children:h.name}),h.location&&Object(p.jsxs)("p",{children:[Object(p.jsx)("i",{className:"fas fa-map-marker-alt"})," ",h.location]}),Object(p.jsx)("button",{className:"buttonDark",onClick:function(){!N&&B(!0)},children:"Send message"})]}),Object(p.jsxs)("div",{className:"userInfo",children:[Object(p.jsx)("button",{className:"buttonDark",onClick:function(){H.push("/basket",{chosenBooks:k,user:h})},disabled:k.length<1,children:"Add to basket"}),Object(p.jsx)("p",{className:"or",children:"OR"}),Object(p.jsx)("button",{className:"buttonDark",onClick:Y,children:"Create poke"})]})]}),N&&Object(p.jsx)(M,{accessToken:t,recipient:h,books:k,setPokeCreatorVisible:y}),A&&Object(p.jsx)(V,{accessToken:t,recipient:h,setMessageCreatorVisible:B})]})},F=function(e){var t=e.loggedUser,r=t.name,n=t.email,a=t.location;return Object(p.jsxs)("div",{className:"meContainer",children:[Object(p.jsx)("h1",{children:"Account details"}),Object(p.jsxs)("p",{children:[Object(p.jsx)("b",{children:"Name:"})," ",r]}),Object(p.jsxs)("p",{children:[Object(p.jsx)("b",{children:"E-mail:"})," ",n]}),Object(p.jsxs)("p",{children:[Object(p.jsx)("b",{children:"Location:"})," ",a||"-"]})]})},J=function(){var e=Object(u.a)(i.a.mark((function e(t,r,n,a,s,c,o,u){var l,j;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(l={}).name=n,0!==a.length&&(l.author=a),0!==s.length&&(l.genres=s),c&&(l.year=c),o&&(l.publisher=o),u&&(l.description=u),e.next=9,fetch("https://pikabook.herokuapp.com/api/books/".concat(r),{method:"put",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(l)});case 9:if((j=e.sent).ok){e.next=17;break}return e.next=13,j.text();case 13:return j=e.sent,e.abrupt("return",{error:j});case 17:return e.next=19,j.json();case 19:return j=e.sent,e.abrupt("return",{updated:!0});case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,c,o,i){return e.apply(this,arguments)}}(),G=function(e){var t=e.accessToken,r=e.setEditBookVisible,a=e.bookData,s=a.name,c=a.author,o=a.genres,j=a.year,b=a.publisher,d=a.description,h=a._id,O=e.getBooks,x=e.setCreatorVisible,f=Object(n.useState)(s),k=Object(l.a)(f,2),m=k[0],v=k[1],g=Object(n.useState)(c.join(", ")),N=Object(l.a)(g,2),y=N[0],C=N[1],w=Object(n.useState)(o.join(", ")),S=Object(l.a)(w,2),D=S[0],T=S[1],A=Object(n.useState)(j),B=Object(l.a)(A,2),I=B[0],_=B[1],P=Object(n.useState)(b),U=Object(l.a)(P,2),R=U[0],L=U[1],E=Object(n.useState)(d),M=Object(l.a)(E,2),z=M[0],V=M[1],q=Object(n.useState)(""),F=Object(l.a)(q,2),G=F[0],H=F[1],W=function(e){return"bookTitle"===e.target.id?v(e.target.value):"author"===e.target.id?C(e.target.value):"genres"===e.target.id?T(e.target.value):"releaseDate"===e.target.id?_(e.target.value):"publisher"===e.target.id?L(e.target.value):"description"===e.target.id?V(e.target.value):void 0},Y=function(){var e=Object(u.a)(i.a.mark((function e(n){var a,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),a=y.split(","),""===y&&(a=[]),s=D.split(","),""===D&&(s=[]),e.next=7,J(t,h,m,a,s,I,R,z);case 7:(c=e.sent).error&&H(c.error),c.updated&&(v(""),C(""),T(""),_(""),L(""),V(""),O(t),x(!1),r(!1));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"creatorContainer",id:"editBookCreator",children:[Object(p.jsxs)("form",{className:"bookForm",onSubmit:Y,children:[Object(p.jsx)("h1",{children:"Edit book"}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"bookTitle",placeholder:"Book's title",value:m,onChange:W,required:!0}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"author",placeholder:"Author",value:y,onChange:W}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"genres",placeholder:"Genres",value:D,onChange:W}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"releaseDate",placeholder:"Release date",value:I,onChange:W}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"publisher",placeholder:"Publisher",value:R,onChange:W}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"description",placeholder:"Description",value:z,onChange:W}),Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{className:"buttonDark",type:"submit",value:"Update"}),Object(p.jsx)("button",{className:"buttonDark",onClick:function(){x(!1),r(!1)},children:"Cancel"})]})]}),G&&Object(p.jsx)("div",{className:"status",children:G})]})},H=function(){var e=Object(u.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/books/".concat(r),{method:"delete",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 2:if((n=e.sent).ok){e.next=10;break}return e.next=6,n.text();case 6:return n=e.sent,e.abrupt("return",{error:n});case 10:return e.next=12,n.json();case 12:return n=e.sent,e.abrupt("return",{deleted:!0});case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),W=function(e){var t=e.accessToken,r=e.data,a=e.getBooks,s=e.creatorVisible,c=e.setCreatorVisible,o=r.name,j=r.author,b=r.genres,d=r.year,h=r.publisher,O=r.description,x=r._id,f=Object(n.useState)(!1),k=Object(l.a)(f,2),m=k[0],v=k[1],g=Object(n.useState)(),y=Object(l.a)(g,2),C=y[0],w=y[1],S=function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c(!0),v(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(u.a)(i.a.mark((function e(r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w("Request..."),r.preventDefault(),e.next=4,H(t,x);case 4:(n=e.sent).error&&w(n.error),n.deleted&&w("Book deleted"),a(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)("div",{className:"bookContainer",children:Object(p.jsxs)("div",{className:"bookInfo",children:[Object(p.jsx)("p",{className:"bookTitle",children:Object(p.jsx)("b",{children:o})}),j.length>0&&Object(p.jsxs)("p",{className:"author",children:[Object(p.jsx)("b",{children:"Author:"})," ",N(j)]}),h&&Object(p.jsxs)("p",{className:"publisher",children:[Object(p.jsx)("b",{children:"Publisher:"})," ",h]}),d&&Object(p.jsxs)("p",{className:"year",children:[Object(p.jsx)("b",{children:"Publication year:"})," ",d]}),b.length>0&&Object(p.jsxs)("p",{className:"genres",children:[Object(p.jsx)("b",{children:"Genre:"})," ",N(b)]}),O&&Object(p.jsxs)("p",{className:"description",children:[Object(p.jsx)("b",{children:"Description:"})," ",O]}),Object(p.jsxs)("div",{className:"meBooksButtons",children:[Object(p.jsx)("button",{className:"buttonDark",onClick:D,disabled:s,children:"Delete"}),Object(p.jsx)("button",{className:"buttonDark",onClick:S,disabled:s,children:"Edit"})]}),C&&Object(p.jsx)("div",{className:"status",children:"Request..."===C?Object(p.jsx)("div",{className:"loader"}):C}),m&&Object(p.jsx)(G,{accessToken:t,setEditBookVisible:v,bookData:r,getBooks:a,setCreatorVisible:c})]})})},Y=function(){var e=Object(u.a)(i.a.mark((function e(t,r,n,a,s,c,o){var u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(u={}).name=r,0!==n.length&&(u.author=n),0!==a.length&&(u.genres=a),s&&(u.year=s),c&&(u.publisher=c),o&&(u.description=o),e.next=9,fetch("https://pikabook.herokuapp.com/api/books",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(u)});case 9:if((l=e.sent).ok){e.next=17;break}return e.next=13,l.text();case 13:return l=e.sent,e.abrupt("return",{added:!1,error:l});case 17:return e.next=19,l.json();case 19:return l=e.sent,e.abrupt("return",{added:!0});case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,c,o){return e.apply(this,arguments)}}(),K=function(e){var t=e.accessToken,r=e.getBooks,a=e.creatorVisible,s=Object(n.useState)(""),c=Object(l.a)(s,2),o=c[0],j=c[1],b=Object(n.useState)(""),d=Object(l.a)(b,2),h=d[0],O=d[1],x=Object(n.useState)(""),f=Object(l.a)(x,2),k=f[0],m=f[1],v=Object(n.useState)(""),g=Object(l.a)(v,2),N=g[0],y=g[1],C=Object(n.useState)(""),w=Object(l.a)(C,2),S=w[0],D=w[1],T=Object(n.useState)(""),A=Object(l.a)(T,2),B=A[0],I=A[1],_=Object(n.useState)(),P=Object(l.a)(_,2),U=P[0],R=P[1],L=function(e){return"bookTitle"===e.target.id?j(e.target.value):"author"===e.target.id?O(e.target.value):"genres"===e.target.id?m(e.target.value):"releaseDate"===e.target.id?y(e.target.value):"publisher"===e.target.id?D(e.target.value):"description"===e.target.id?I(e.target.value):void 0},E=function(){var e=Object(u.a)(i.a.mark((function e(n){var a,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R("Request..."),n.preventDefault(),a=h.split(","),""===h&&(a=[]),s=k.split(","),""===k&&(s=[]),e.next=8,Y(t,o,a,s,N,S,B);case 8:(c=e.sent).error&&R(c.error),c.added&&R("Book successfully added"),j(""),O(""),m(""),y(""),D(""),I(""),r(t);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"meAddBook",children:[Object(p.jsx)("h1",{className:"booksHeading",children:"Add a new book"}),Object(p.jsxs)("form",{className:"bookForm",onSubmit:E,children:[Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"bookTitle",placeholder:"Book's title",value:o,onChange:L,required:!0}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"author",placeholder:"Author",value:h,onChange:L}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"genres",placeholder:"Genres",value:k,onChange:L}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"releaseDate",placeholder:"Release date",value:N,onChange:L}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"publisher",placeholder:"Publisher",value:S,onChange:L}),Object(p.jsx)("input",{className:"textInputDark",type:"text",id:"description",placeholder:"Description",value:B,onChange:L}),Object(p.jsx)("input",{type:"submit",value:"Add",className:"buttonDark",disabled:a}),U&&Object(p.jsx)("div",{className:"status",children:"Request..."===U?Object(p.jsx)("div",{className:"loader"}):U})]})]})},Q=function(e){var t=e.accessToken,r=Object(n.useState)([]),a=Object(l.a)(r,2),s=a[0],c=a[1],o=Object(n.useState)("Loading..."),j=Object(l.a)(o,2),b=j[0],d=j[1],h=Object(n.useState)(1),O=Object(l.a)(h,2),x=O[0],f=O[1],k=Object(n.useState)(!1),m=Object(l.a)(k,2),v=m[0],g=m[1],N=Object(n.useRef)(),y=function(){var e=Object(u.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C(t);case 2:(r=e.sent).error&&(console.log(r.error),d("No books found.")),r.books&&(c(r.books.reverse()),d(""));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){y(t)}),[t]);var w=D(x,10,s);return w=w.map((function(e){return Object(p.jsx)(W,{accessToken:t,data:e,getBooks:y,creatorVisible:v,setCreatorVisible:g},e._id)})),Object(p.jsxs)("div",{className:"meBooksContainer",children:[Object(p.jsxs)("div",{className:"meBooks",ref:N,children:[Object(p.jsx)("h1",{className:"booksHeading",children:"My books"}),w.length>0&&w,b&&Object(p.jsx)("div",{className:"status",children:"Loading..."===b?Object(p.jsx)("div",{className:"loader"}):b}),s.length>10&&Object(p.jsx)(T,{page:x,setPage:f,list:s,limit:10,scrollTo:N})]}),Object(p.jsx)(K,{accessToken:t,getBooks:y,creatorVisible:v})]})},X=function(){return Object(p.jsx)("div",{children:"Me_Baskets"})},Z=function(e){var t=e.conversation,r=t.interlocutors,n=t.messages,a=e.loggedUser,s=Object(b.g)(),c=r.find((function(e){return e._id!==a._id})),o=n[0],i=new Date(o.date).toLocaleString(),u=o.sender===c._id?c.name:"You",l=o.content.split("").slice(0,9).join(""),j=!o.read&&o.recipient===a._id;return Object(p.jsxs)("div",{className:j?"conversationContainer newMessage":"conversationContainer",children:[Object(p.jsx)("div",{children:Object(p.jsx)("b",{children:c.name})}),Object(p.jsx)("div",{children:i}),Object(p.jsxs)("div",{children:[Object(p.jsx)("b",{children:u})," wrote:"," ",l===o.content?l:"".concat(l,"...")]}),Object(p.jsx)("button",{className:"buttonDark",onClick:function(){s.push("/me/conversations/conversation",{interlocutor:c})},children:"Go to conversation"})]})},$=function(e){var t=e.loggedUser,r=e.loggedUsersConversations,a=Object(n.useState)(1),s=Object(l.a)(a,2),c=s[0],o=s[1],i=Object(n.useRef)(),u=r.sort((function(e,t){var r=new Date(e.messages[0].date);return new Date(t.messages[0].date)-r}));return u=(u=D(c,10,u)).map((function(e){return Object(p.jsx)(Z,{conversation:e,loggedUser:t},e._id)})),Object(p.jsxs)("div",{className:"conversationsContainer",children:[Object(p.jsx)("h1",{children:"My conversations"}),Object(p.jsx)("div",{ref:i,children:r.length>10&&Object(p.jsx)(T,{page:c,setPage:o,list:r,limit:10,scrollTo:i})}),Object(p.jsx)("div",{children:u}),r.length>10&&Object(p.jsx)(T,{page:c,setPage:o,list:r,limit:10,scrollTo:i})]})},ee=r(24),te=r.n(ee),re=function(){var e=Object(u.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/me/conversations",{method:"get",headers:{Authorization:"Bearer ".concat(t)}});case 2:if((r=e.sent).ok){e.next=10;break}return e.next=6,r.text();case 6:return r=e.sent,e.abrupt("return",{error:r});case 10:return e.next=12,r.json();case 12:return r=e.sent,e.abrupt("return",{conversations:r});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=Object(u.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/me/conversations/".concat(r,"?")+new URLSearchParams(n),{method:"get",headers:{Authorization:"Bearer ".concat(t)}});case 2:if((a=e.sent).ok){e.next=10;break}return e.next=6,a.text();case 6:return a=e.sent,e.abrupt("return",{error:a});case 10:return e.next=12,a.json();case 12:return a=e.sent,e.abrupt("return",{conversation:a});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),ae=function(){var e=Object(u.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/conversations/".concat(r),{method:"put",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 2:if((n=e.sent).ok){e.next=10;break}return e.next=6,n.text();case 6:return n=e.sent,e.abrupt("return",{error:n});case 10:return e.next=12,n.json();case 12:return n=e.sent,e.abrupt("return",{updated:!0});case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),se=function(e){var t=e.message,r=t.sender,n=t.content,a=t.date,s=e.interlocutor,c=new Date(a).toLocaleString(),o=s._id===r?"".concat(s.name,":"):"You:";return Object(p.jsxs)("div",{className:"You:"===o?"yourMessage":"interlocutorsMessage",children:[Object(p.jsx)("div",{className:"date",children:c}),Object(p.jsxs)("div",{className:"message",children:[Object(p.jsx)("div",{children:o}),Object(p.jsx)("div",{children:n})]})]})},ce=function(e){var t=e.accessToken,r=e.getLoggedUsersConversations,a=e.conversationsInterval,s=Object(b.h)(),c=Object(b.g)(),o=s.state.interlocutor,j=Object(n.useState)([]),d=Object(l.a)(j,2),h=d[0],O=d[1],x=Object(n.useRef)(),f=Object(n.useState)(""),k=Object(l.a)(f,2),m=k[0],v=k[1],g=Object(n.useRef)(),N=Object(n.useState)(10),y=Object(l.a)(N,2),C=y[0],w=y[1],S=Object(n.useState)(""),D=Object(l.a)(S,2),T=D[0],A=D[1],B=Object(n.useRef)();Object(n.useEffect)((function(){var e=function(){var e=Object(u.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.some((function(e){return!e.read}))){e.next=3;break}return e.next=3,ae(t,o._id);case 3:clearTimeout(a.current),r(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n=function(){var r=Object(u.a)(i.a.mark((function r(){var n,a;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return A("Loading..."),x.current=h,r.next=4,ne(t,o._id,{limit:C});case 4:(n=r.sent).error&&A(n.error),a=n.conversation.messages.reverse(),te.a.isEqual(a,x.current)||(O(a),e(a));case 8:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();clearInterval(g.current),n();var s=setInterval(Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n());case 1:case"end":return e.stop()}}),e)}))),1e3);return g.current=s,function(){return clearInterval(g.current)}}),[t,o._id,C,h,r,a]),Object(n.useEffect)((function(){var e=B.current;!function(){var t=e.scrollHeight-e.clientHeight;e.scrollTo(0,t)}()}),[h]);var I=function(){var e=Object(u.a)(i.a.mark((function e(r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,z(t,o._id,m);case 3:(n=e.sent).error&&A(n.error),v("");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=h.map((function(e){return Object(p.jsx)(se,{message:e,interlocutor:o},e._id)}));return Object(p.jsxs)("div",{className:"singleConversationContainer",children:[Object(p.jsx)("div",{className:"exit",onClick:function(){c.push("/me/conversations")},children:"\u2716"}),Object(p.jsx)("button",{className:"buttonDark loadMore",onClick:function(e){w(C+10)},children:"\u2191"}),Object(p.jsx)("div",{className:"messagesList",ref:B,children:0===h.length?Object(p.jsxs)("div",{className:"status",children:[" ","Loading..."===T?Object(p.jsx)("div",{className:"loader"}):T," "]}):_}),Object(p.jsxs)("form",{onSubmit:I,children:[Object(p.jsx)("textarea",{onChange:function(e){v(e.target.value)},value:m}),Object(p.jsx)("input",{className:"buttonDark",type:"submit",value:"Send"})]})]})},oe=r(19),ie=function(e){var t=e.bookList,r=e.creationDate,n=e.sender,a=e.read,s=e.handleOnClick;return Object(p.jsxs)("div",{className:a?"poke":"newPoke poke",children:[t.length>0?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("p",{children:["On ",r," ",Object(p.jsx)("b",{children:n.name})," showed interest in the following books in your collection:"]}),Object(p.jsx)("ul",{children:t})]}):Object(p.jsxs)("p",{children:["On ",r," ",Object(p.jsx)("b",{children:n.name})," showed interest in your collection. "]}),Object(p.jsxs)("button",{className:"buttonDark",onClick:s,children:["Visit ",Object(p.jsx)("b",{children:n.name}),"'s profile"]})]})},ue=function(e){var t=e.bookList,r=e.creationDate,n=e.recipient,a=e.handleOnClick;return Object(p.jsxs)("div",{className:"poke",children:[t.length>0?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("p",{children:["On ",r," you showed interest in the following books in"," ",Object(p.jsx)("b",{children:n.name}),"'s collection:"]}),Object(p.jsx)("ul",{children:t})]}):Object(p.jsxs)("p",{children:["On ",r," you showed interest in ",Object(p.jsx)("b",{children:n.name}),"'s' collection. "]}),Object(p.jsxs)("button",{className:"buttonDark",onClick:a,children:["Visit ",Object(p.jsx)("b",{children:n.name}),"'s profile"]})]})},le=function(e){var t=e.poke,r=t.sender,n=t.recipient,a=t.books,s=t.date,c=t.read,o=e.type,i=Object(b.g)(),u=new Date(s).toLocaleString(),l=function(){"received"===o&&i.push("/user/".concat(r._id),{bookId:""}),"sent"===o&&i.push("/user/".concat(n._id),{bookId:""})},j=a.map((function(e){return Object(p.jsx)(L,{book:e},e._id)}));return Object(p.jsxs)("div",{children:["received"===o&&Object(p.jsx)(ie,{bookList:j,creationDate:u,sender:r,read:c,handleOnClick:l}),"sent"===o&&Object(p.jsx)(ue,{bookList:j,creationDate:u,recipient:n,handleOnClick:l})]})},je=function(){var e=Object(u.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/pokes/".concat(r),{method:"put",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 2:if((n=e.sent).ok){e.next=10;break}return e.next=6,n.text();case 6:return n=e.sent,e.abrupt("return",{error:n});case 10:return e.next=12,n.json();case 12:return n=e.sent,e.abrupt("return",{updated:!0});case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),be=function(e){var t=e.accessToken,r=e.loggedUsersPokes,a=e.setLoggedUsersPokes,s=e.loggedUser._id,c=Object(n.useState)(1),o=Object(l.a)(c,2),i=o[0],u=o[1],j=Object(n.useState)(1),b=Object(l.a)(j,2),d=b[0],h=b[1],O=Object(n.useState)([]),x=Object(l.a)(O,2),f=x[0],k=x[1],m=10,v=Object(n.useRef)(),g=Object(n.useRef)();Object(n.useEffect)((function(){if(r.length!==f.length&&k(r),r.filter((function(e){return e.recipient._id===s})).some((function(e){return!e.read}))){var e=r.map((function(e){return je(t,e._id),Object(oe.a)(Object(oe.a)({},e),{},{read:!0})}));a(e)}}),[t,r,a,f,s]);var N=f.filter((function(e){return e.recipient._id===s})),y=f.filter((function(e){return e.sender._id===s})),C=D(i,m,N);C=C.map((function(e){return Object(p.jsx)(le,{poke:e,type:"received"},e._id)}));var w=D(d,m,y);return w=w.map((function(e){return Object(p.jsx)(le,{poke:e,type:"sent"},e._id)})),Object(p.jsxs)("div",{className:"pokesContainer",children:[Object(p.jsxs)("div",{className:"pokeColumn1",ref:v,children:[Object(p.jsx)("h1",{children:"Pokes received"}),Object(p.jsx)("div",{className:"pokeContainer",children:C}),N.length>m&&Object(p.jsx)(T,{page:i,setPage:u,list:N,limit:m,scrollTo:v})]}),Object(p.jsxs)("div",{className:"pokeColumn2",ref:g,children:[Object(p.jsx)("h1",{children:"Pokes sent"}),Object(p.jsx)("div",{className:"pokeContainer",children:w}),y.length>m&&Object(p.jsx)(T,{page:d,setPage:h,list:y,limit:m,scrollTo:g})]})]})},de=function(){var e=Object(u.a)(i.a.mark((function e(t,r,n,a){var s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/baskets",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({targetUserID:r,booksOffered:n,booksRequested:a})});case 2:if((s=e.sent).ok){e.next=10;break}return e.next=6,s.text();case 6:return s=e.sent,e.abrupt("return",{error:s});case 10:return e.next=12,s.json();case 12:return s=e.sent,e.abrupt("return",{created:!0});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),pe=function(e){var t=e.accessToken,r=e.recipient,a=e.booksOffered,s=e.booksRequested,c=e.setBasketCreatorVisible,o=Object(n.useState)(""),j=Object(l.a)(o,2),d=j[0],h=j[1],O=Object(b.g)(),x=function(){var e=Object(u.a)(i.a.mark((function e(){var n,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.map((function(e){return e._id})),c=a.map((function(e){return e._id})),e.next=4,de(t,r._id,c,n);case 4:(o=e.sent).error&&h(o.error),o.created&&h("Offer successfully sent!"),setTimeout((function(){return O.push("/me/basket")}),1e3);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=a.map((function(e){return Object(p.jsx)(L,{book:e},e._id)})),k=s.map((function(e){return Object(p.jsx)(L,{book:e},e._id)}));return Object(p.jsxs)("div",{className:"creatorContainer",id:"basketCreator",children:[!d&&Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("p",{children:["Confirm that you want to send ",r.name," an offer to exchange your books:"]}),Object(p.jsx)("ul",{children:f}),Object(p.jsx)("p",{children:"against his/her books"}),Object(p.jsx)("ul",{children:k})]}),d&&Object(p.jsx)("p",{children:Object(p.jsx)("b",{children:d})}),Object(p.jsxs)("div",{children:[!d&&Object(p.jsx)("button",{className:"buttonDark",onClick:x,children:"Confirm"}),!d&&Object(p.jsx)("button",{className:"buttonDark",onClick:function(){c(!1)},children:"Cancel"})]})]})},he=function(e){var t=e.accessToken,r=Object(b.h)(),a=r.state.user,s=r.state.chosenBooks,c=Object(n.useState)([]),o=Object(l.a)(c,2),j=o[0],d=o[1],h=Object(n.useState)([]),O=Object(l.a)(h,2),x=O[0],f=O[1],k=Object(n.useState)(!1),m=Object(l.a)(k,2),v=m[0],g=m[1],N=Object(n.useState)(1),y=Object(l.a)(N,2),w=y[0],S=y[1],A=Object(n.useState)(1),B=Object(l.a)(A,2),I=B[0],_=B[1],P=10,L=Object(n.useRef)(),E=Object(n.useRef)();Object(n.useEffect)((function(){(function(){var e=Object(u.a)(i.a.mark((function e(){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C(t);case 2:(r=e.sent).error&&console.log(r.error),r.books&&f(r.books);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]);var M=function(e){d(U(e,x,j))},z=function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=D(w,P,s);V=V.map((function(e){return Object(p.jsx)(R,{book:e},e._id)}));var q=D(I,P,x);return q=q.map((function(e){return Object(p.jsx)(R,{book:e,type:"checkbox",handleCheckboxChange:M,inputDisabled:v,chosenBooks:j},e._id)})),Object(p.jsxs)("div",{className:"createBasketContainer",children:[Object(p.jsxs)("div",{className:"basketBookList",ref:L,children:[Object(p.jsxs)("div",{className:"basketChosenBooks",children:[Object(p.jsxs)("h1",{className:"booksHeading",children:[a.name,"'s books"]}),V,s.length>P&&Object(p.jsx)(T,{page:w,setPage:S,list:s,limit:P,scrollTo:L})]}),Object(p.jsxs)("div",{className:"basketMyBooks",ref:E,children:[Object(p.jsx)("h1",{className:"booksHeading",children:"My books"}),q,x.length>P&&Object(p.jsx)(T,{page:I,setPage:_,list:x,limit:P,scrollTo:E})]})]}),Object(p.jsx)("button",{className:"buttonDark",onClick:z,disabled:j.length<1,children:"Create a basket"}),v&&Object(p.jsx)(pe,{accessToken:t,booksOffered:j,booksRequested:s,recipient:a,setBasketCreatorVisible:g})]})},Oe=function(){return Object(p.jsx)("div",{children:"Page does not exist."})},xe=function(){var e=Object(u.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pikabook.herokuapp.com/api/me/pokes",{method:"get",headers:{Authorization:"Bearer ".concat(t)}});case 2:if((r=e.sent).ok){e.next=10;break}return e.next=6,r.text();case 6:return r=e.sent,e.abrupt("return",{error:r});case 10:return e.next=12,r.json();case 12:return r=e.sent,e.abrupt("return",{pokes:r});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var fe=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),r=t[0],a=t[1],s=Object(n.useState)({}),c=Object(l.a)(s,2),o=c[0],d=c[1],h=Object(n.useState)([]),x=Object(l.a)(h,2),k=x[0],v=x[1],N=Object(n.useState)([]),y=Object(l.a)(N,2),C=y[0],w=y[1],S=Object(n.useRef)(),D=Object(n.useRef)();Object(n.useEffect)((function(){clearInterval(S.current),clearInterval(D.current),r&&(T(r),I(r),_(r)),r||(v([]),d({}),w([]))}),[r]);var T=function(){var e=Object(u.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t);case 2:(r=e.sent).error&&console.log(r.error),r.user&&d(r.user);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(u.a)(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=function(){var e=Object(u.a)(i.a.mark((function e(){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe(t);case 2:(r=e.sent).error&&console.log(r.error),r.pokes&&v(r.pokes.reverse());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())(),n=setInterval(Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r());case 1:case"end":return e.stop()}}),e)}))),5e3),S.current=n,e.abrupt("return",(function(){return clearInterval(S.current)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(u.a)(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=function(){var e=Object(u.a)(i.a.mark((function e(){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t);case 2:(r=e.sent).error&&console.log(r.error),r.conversations&&w(r.conversations);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())(),n=setInterval(Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r());case 1:case"end":return e.stop()}}),e)}))),5e3),D.current=n,e.abrupt("return",(function(){return clearInterval(D.current)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)(j.a,{basename:"/CodersCamp2020.Project.FullStack-Node-React.PikaBook-frontend",children:[Object(p.jsx)(O,{setAccessToken:a,accessToken:r,loggedUser:o,loggedUsersPokes:k,loggedUsersConversations:C}),Object(p.jsx)("main",{children:Object(p.jsxs)(b.d,{children:[Object(p.jsx)(b.b,{path:"/",exact:!0,render:function(){return r?Object(p.jsx)(b.a,{to:"/search"}):Object(p.jsx)(m,{setAccessToken:a,setLoggedUser:d})}}),Object(p.jsx)(b.b,{path:"/registration",render:function(){return r?Object(p.jsx)(b.a,{to:"/search"}):Object(p.jsx)(g,{setAccessToken:a})}}),Object(p.jsx)(b.b,{path:"/search",exact:!0,render:function(){return r?Object(p.jsx)(A,{accessToken:r,loggedUser:o}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/user/:id",exact:!0,render:function(){return r?Object(p.jsx)(q,{accessToken:r}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/basket",render:function(){return r?Object(p.jsx)(he,{accessToken:r}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/me",exact:!0,render:function(){return r?Object(p.jsx)(F,{accessToken:r,loggedUser:o}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/me/books",render:function(){return r?Object(p.jsx)(Q,{accessToken:r}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/me/pokes",render:function(){return r?Object(p.jsx)(be,{accessToken:r,loggedUsersPokes:k,setLoggedUsersPokes:v,loggedUser:o}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/me/conversations",exact:!0,render:function(){return r?Object(p.jsx)($,{accessToken:r,loggedUser:o,loggedUsersConversations:C}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/me/conversations/conversation",render:function(){return r?Object(p.jsx)(ce,{accessToken:r,getLoggedUsersConversations:_,conversationsInterval:D}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{path:"/me/basket",render:function(){return r?Object(p.jsx)(X,{accessToken:r}):Object(p.jsx)(b.a,{to:"/"})}}),Object(p.jsx)(b.b,{render:function(){return Object(p.jsx)(Oe,{})}})]})}),Object(p.jsx)(f,{})]})};c.a.render(Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(fe,{})}),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.588728b5.chunk.js.map